{"version":3,"sources":["routes/posts/2019-08-27-Data Engineering Pt 2/document.mdx","routes/posts/2019-08-27-Data Engineering Pt 2/document.module.css","routes/posts/2019-08-27-Data Engineering Pt 2/hacker.gif","routes/posts/2019-08-27-Data Engineering Pt 2/another_hacker.gif"],"names":["readingTime","text","minutes","time","words","layoutProps","MDXLayout","MDXContent","_ref","components","props","Object","_home_user_Documents_projects_blog_client_react_blog_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectWithoutProperties__WEBPACK_IMPORTED_MODULE_0__","_mdx_js_react__WEBPACK_IMPORTED_MODULE_2__","assign","mdxType","parentName","href","id","className","styles","src","another_hacker","alt","style","color","hacker","data-language","data-highlighted-line-numbers","dangerouslySetInnerHTML","__html","isMDXComponent","tableOfContents","arguments","length","undefined","level","title","children","frontMatter","module","exports","image","figure","figureright","figureleft","sidebarcontainer","sidebar","__webpack_require__","p"],"mappings":"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","file":"static/js/5.7cb2b7b2.chunk.js","sourcesContent":["\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\nexport const readingTime = {\"text\":\"16 min read\",\"minutes\":15.145,\"time\":908699.9999999999,\"words\":3029}\n/* @jsx mdx */\nimport styles from './document.module.css'\nimport hacker from './hacker.gif'\nimport another_hacker from './another_hacker.gif'\n\nconst makeShortcode = name => function MDXDefaultShortcode(props) {\n  console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\")\n  return <div {...props}/>\n};\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n    <p>{`In the `}<a parentName=\"p\" {...{\n        \"href\": \"../../2019-08-19/Data-Engineering-Pt-1\"\n      }}>{`last post`}</a>{` we discussed a simple requirement to store tweets and make them available to other applications. It quickly became clear that it wasn’t as simple as it looked - in fact, it was so complicated that it actually called for an entire platform to be built, replete with a full data plane and separate control plane.`}</p>\n    <p>{`Mocking up the platform side of things is the subject of this post, in which we’ll discuss getting a dev environment set up. Once you land in an organisation, the first thing you often want to do is replicate their production environment as closely as possible, ideally locally on your own machine. This allows you to test your application in an environment that mirrors the one it will ultimately run in.`}</p>\n    <h3 {...{\n      \"id\": \"but-my-code-is-already-unit-tested\"\n    }}>{`“But my code is already unit tested!”`}</h3>\n    <figure className={styles[\"figure\"]}>\n  <img src={another_hacker} className={styles[\"image\"]} alt=\"Cool guy coding.\" />\n  <figcaption>No number of unit tests will make you this guy.</figcaption>\n    </figure>\n    <p>{`This is a common objection to this approach when you present it to traditional software engineers. But if those tests are like most I’ve seen, I suspect that they might say something very deep and subtle like `}<inlineCode parentName=\"p\">{`assert MyClass==MyClass`}</inlineCode>{`. This is roughly equivalent to the conversation at every bad first date you’ve ever been on. `}<em parentName=\"p\">{`Your tests will agree with a set of statements which only a psychopathic piece of code would fail to agree with, and which tell you nothing about the inner workings of the subject under examination; much less its performance in your particular environment, how it will get along with the rest of the apps if invited to a party, whether it will try to monopolise your limited resources, or knows how to clean up after itself.`}</em></p>\n    <p>{`Sorry, we were talking about software weren’t we…`}</p>\n    <p>{`Even if you’ve gone to the trouble of finding a proper test framework and using some sample data (because this is about data science, remember?) `}<strong parentName=\"p\">{`the scale or velocity of that data may be completely different in the real world - this is often the problem you are trying to solve.`}</strong>{` So unit testing doesn’t really cut the mustard, `}<em parentName=\"p\">{`and actually the local testing approach we demonstrate here isn’t very thorough either, but it doesn’t require you to go and buy resources on GCP or AWS, so that’s a plus, and you can always do that later.`}</em></p>\n    <div className={styles[\"sidebarcontainer\"]}>\n      <span className={styles[\"sidebar\"]}>\n        <h3 {...{\n          \"id\": \"whats-in-the-box-about-the-images-were-using\"\n        }}>{`What’s in the box? About the images we’re using.`}</h3>\n        <p>{`This is a mock platform, so it is going to be missing things. While you’re welcome to talk to me on Twitter about all the things it is missing, I expect that there will be a vast number. What we are including however, is;`}</p>\n        <ul>\n          <li parentName=\"ul\">{`gcr.io/etcd-development/etcd:v3.3.13`}</li>\n          <li parentName=\"ul\">{`landoop/fast-data-dev`}</li>\n          <li parentName=\"ul\">{`fluent/fluentd:v1.3-debian-1`}</li>\n        </ul>\n        <p>{`Oh? You went and ran `}<inlineCode parentName=\"p\">{`Docker pull`}</inlineCode>{` didn’t you? Sorry,`}<strong parentName=\"p\">{` Minikube runs in a VM with a wholly separate filesystem.`}</strong>{` You may want to delete those if you’re short of disk space. Minikube creates and deletes VMs all the time, so add the above images to a cache using `}<inlineCode parentName=\"p\">{`minikube cache add \\${IMAGE}`}</inlineCode>{` to avoid re-downloading frequently.`}</p>\n        <p>{`The etcd and fluentd images are provided by the organisations developing both tools. The `}<a parentName=\"p\" {...{\n            \"href\": \"https://github.com/Landoop/fast-data-dev\"\n          }}>{`Landoop Kafka image`}</a>{` is one that I see out in the industry semi-regularly, it contains a full Kafka setup which includes Zookeeper and a Schema Registry, alongside some GUI tools to inspect your cluster and make sure it is giving the expected results. Feel free to work something up from the official Confluent images or similar if that’s more your speed, but be prepared to spend a great deal of time kludging around with unwieldly arguments with Kafka’s CLI tools `}<em parentName=\"p\">{`(I’m generally a CLI fan, but only where they have been designed for humans, or indeed designed at all)`}</em>{`.`}</p>\n      </span>\n      <h2 {...{\n        \"id\": \"pre-requisites\"\n      }}>{`Pre-requisites`}</h2>\n      <p>{`I will assume you have Docker installed and are reasonably proficient at using it. There are plenty of tutorials to help with that, so I’ll suggest a Google search if you hit issues. You will also need to install `}<a parentName=\"p\" {...{\n          \"href\": \"https://kubernetes.io/docs/setup/learning-environment/minikube/\"\n        }}>{`Minikube`}</a>{` and `}<a parentName=\"p\" {...{\n          \"href\": \"https://kubernetes.io/docs/tasks/tools/install-kubectl/\"\n        }}>{`Kubectl`}</a>{`, which we’ll use to mock Kubernetes (but only gently, so as not to hurt its feelings). `}<strong parentName=\"p\">{`I strongly advise enabling autocompletion`}</strong>{` for Kubectl (and most CLI’s generally), and future you will be greatful to be one of the few engineers without RSI if you do so.`}</p>\n      <p>{`I’m running everything on Linux, and you can look up instructions for Windows. `}<em parentName=\"p\">{`(Personally, my advice is “perhaps consider a different career path, I hear accounting is nice and has something to do with numbers, so it must be just like AI - right?” Ironically, I’m relying on readers not taking this advice to keep my potential readership relatively high - because Windows is still quite dominant.)`}</em></p>\n      <p>{`You’ll also need to ensure you have git installed - presumably you’re familiar with it as well, otherwise its back to Coursera with you. Or you can enjoy the `}<a parentName=\"p\" {...{\n          \"href\": \"https://git-man-page-generator.lokaltog.net/\"\n        }}>{`documentation`}</a>{` (that link points to a parody, but I can’t tell the difference).`}</p>\n      <h2 {...{\n        \"id\": \"getting-started---minikube\"\n      }}>{`Getting started - Minikube`}</h2>\n      <p>{`If you’ve recovered from reading the parody Git manpages, `}<strong parentName=\"p\">{`you can clone the `}<a parentName=\"strong\" {...{\n            \"href\": \"https://github.com/Miles-Garnsey/DataEngineeringPt2\"\n          }}>{`repo`}</a>{` if you’re following along.`}</strong></p>\n      <p>{`Bring minikube up using `}<inlineCode parentName=\"p\">{`minikube start --memory=8192 --cpus=2 --extra-config=apiserver.enable-admission-plugins=PodSecurityPolicy`}</inlineCode>{`, and wait for… a long time… (Note that there is advice floating about online suggesting you can use something like `}<inlineCode parentName=\"p\">{`--extra-config=apiserver.GenericServerRunOptions.AdmissionControl=....`}</inlineCode>{` - this was deprecated, and leads to fierce and incomprehensible errors, as does the attempted use of things like PersistentVolumeLabel. Meanwhile, various admission plugins are enabled by default, so the only one we need to focus on is `}<inlineCode parentName=\"p\">{`PodSecurityPolicy`}</inlineCode>{`.)`}</p>\n      <span style={{\n        color: 'red'\n      }}> (**EDIT: September 19:** starting this week I've had some trouble with this approach. Haven't had time to research properly; initially I suspected that minikube may have updated something to require `--extra-config=apiserver.authorization-mode=RBAC`. But having done a bit more reading (per this [link](https://github.com/kubernetes/minikube/issues/3818)), I think I neglected to configure some security policies authorizing the core services - this naturally prevents the cluster from coming up. I've updated the github repo for this post to include the relevant policies in `psp.yaml`, which needs to be copied to `~/.minikube/files/etc/kubernetes/addons/psp.yaml`, and I've updated `k8s-configure.sh` to include this step. I may write an additional post exploring psp.yaml and providing more detail on how it works, it gave me some insight to fix up my podsecuritypolicy settings which I've improved in `devSecurity.yaml`, as I don't believe these were being applied as intended. </span>\n      <p>{`Once it is up, you should have a mock K8s cluster running in a VM, which you can describe using your kubectl commands such as `}<inlineCode parentName=\"p\">{`kubectl describe-cluster`}</inlineCode>{`. If that all works, we’re good to go.`}</p>\n    </div>\n    <h2 {...{\n      \"id\": \"kubernetes-concepts-and-setup\"\n    }}>{`Kubernetes Concepts and setup`}</h2>\n    <p>{`Kubernetes has a few entities you’ll need to familiar with, notably - nodes, pods, services, controllers and containers. The documentation on the main website is somewhat unsatisfactory when it comes to describing the design succinctly, and I advise you to consult the `}<a parentName=\"p\" {...{\n        \"href\": \"https://github.com/kubernetes/community/blob/master/contributors/design-proposals/architecture/architecture.md#the-kubernetes-node\"\n      }}>{`architecture doc`}</a>{` for detail. `}<strong parentName=\"p\">{`Summarising, containers are just Docker containers (at least for our purposes), they run in pods on nodes, which are hosts, and are exposed by services which do network related stuff like load balancing, DNS (including discovery etc.), controllers do deployment and scaling. The pod is kind of the interesting part of Kubernetes that differentiates it from Docker compose in many ways.`}</strong></p>\n    <span className={styles[\"sidebar\"]}>\n      <h2 {...{\n        \"id\": \"running-an-application-on-kubernetes\"\n      }}>{`Running an application on Kubernetes`}</h2>\n      <p>{`Kubernetes is so flexible that the number of configurables can become overwhelming, so it helps to have a checklist of considerations when you’re crafting a deployment. `}<strong parentName=\"p\">{`The basics you want to include are;`}</strong></p>\n      <ol>\n        <li parentName=\"ol\">{`A namespace`}</li>\n        <li parentName=\"ol\">{`Memory and CPU limits`}</li>\n        <li parentName=\"ol\">{`A container image`}</li>\n        <li parentName=\"ol\">{`A service to handle load balancing`}</li>\n        <li parentName=\"ol\">{`The number of replicas you’ll require`}</li>\n        <li parentName=\"ol\">{`(Optional, stateful applications only) Any volumes you’ll need.`}</li>\n      </ol>\n      <p><em parentName=\"p\">{`N.B. - it should be noted that management love checklists for the same reason you like this one, they’re just overwhelmed by more things; if you show your boss this checklist (and pass it off as your own) you will be able to run a meeting about Standardising Processes which will assure you of a tidy bonus while simultaneously earning you the undying contempt of your colleagues.`}</em>{` `}<strong parentName=\"p\">{`Good luck!`}</strong></p>\n    </span>\n    <h3 {...{\n      \"id\": \"kubernetes-pods\"\n    }}>{`Kubernetes pods`}</h3>\n    <p>{`Applications are deployed in pods, and each instance of the application container should be in its own pod. Pods do not handle replication. Instead, `}<strong parentName=\"p\">{`think of them as a way of packaging the application for runtime/production`}</strong>{`. A production environment might mandate that all applications use a particular set of subsidiary apps/containers. Many of these might operate separately from the application itself, and this is called the `}<strong parentName=\"p\">{`Sidecar Pattern`}</strong>{`. Some of the common things included are proxies that inspect network traffic before forwarding it to the container it was intended for, but there are a variety of use cases around application monitoring, networking, and other stuff that ops people care about and we aren’t going to talk about.`}</p>\n    <p><strong parentName=\"p\">{`Side note:`}</strong>{` pods are the thing that enable service mesh frameworks like `}<a parentName=\"p\" {...{\n        \"href\": \"https://istio.io/\"\n      }}>{`Istio`}</a>{` to fly. Istio (for example) installs a hook into K8s which modifies its default pod deployment behaviour and adds additional stuff. I may write a post about this later - one interesting implication is that we could consider taking REST traffic from our existing apps and proxying it to Kafka traffic to ameliorate the deficiencies REST suffers in persistence. There are also technologies such as Cilium, which bundles in additional security and might be worth evaluating for its Kafka interop. I only mention to sketch some of the flexibility available via Kubernetes.`}</p>\n    <h3 {...{\n      \"id\": \"controllers-services-and-everything-else\"\n    }}>{`Controllers, services… and everything else`}</h3>\n    <p>{`Examples of controllers include `}<strong parentName=\"p\"><a parentName=\"strong\" {...{\n          \"href\": \"https://kubernetes.io/docs/concepts/workloads/controllers/replicaset/\"\n        }}>{`replica sets`}</a>{` (which is what we’re using here), stateful sets, daemon sets, deployments`}</strong>{` and so on. These are just all different ways of getting some set of pods out onto some set of nodes in a cluster and keeping some number there under different conditions (the desired number being something that might change according to various scaling behaviours that we’ll discuss much later). The documentation is sufficent to explain what these do, so I will not cover them in depth beyond mentioning their existence.`}</p>\n    <figure className={styles[\"figure\"]}>\n  <img src={hacker} className={styles[\"image\"]} alt=\"A very serious hacker.\" />\n  <figcaption>Crash override fails on ClusterIP.</figcaption>\n    </figure>\n    <p>{`As mentioned above; services do networking things, and in this series we are going to talk purely about `}<inlineCode parentName=\"p\">{`ClusterIP`}</inlineCode>{` services, which do not expose external IPs. If you have the privelege of having customers who might be interested in your app, you would be looking at load balancing, creating static public IP addresses, and other things that would require care and thought. You should not do any of these things unless you understand the security implications. `}<strong parentName=\"p\">{`One more time. Do not do any of those things unless you understand the security implications.`}</strong></p>\n    <p>{`If you want to add to the K8s API, you’ll be pleased to hear that its entities are customisable. Customised resources that don’t fit within the node/service/pod/container/controller paradigm are quite possible. This is an approach pursued by tools such as `}<a parentName=\"p\" {...{\n        \"href\": \"https://www.kubeflow.org/\"\n      }}>{`Kubeflow`}</a>{` which adds various machine learning tooling to K8s. This is quite useful, and worth keeping in mind if you plan to run some such service at scale.`}</p>\n    <h3 {...{\n      \"id\": \"defining-kubernetes-entities\"\n    }}>{`Defining Kubernetes entities`}</h3>\n    <div className={styles[\"floatright\"]}>\n      <pre><code parentName=\"pre\" {...{\n          \"className\": \"language-yaml\",\n          \"data-language\": \"yaml\",\n          \"data-highlighted-line-numbers\": \"\",\n          \"dangerouslySetInnerHTML\": {\n            \"__html\": \"<span class=\\\"token key atrule\\\">apiVersion</span><span class=\\\"token punctuation\\\">:</span> v1\\n<span class=\\\"token key atrule\\\">kind</span><span class=\\\"token punctuation\\\">:</span> Service\\n<span class=\\\"token key atrule\\\">metadata</span><span class=\\\"token punctuation\\\">:</span>\\n  <span class=\\\"token key atrule\\\">name</span><span class=\\\"token punctuation\\\">:</span> kafka<span class=\\\"token punctuation\\\">-</span>service\\n  <span class=\\\"token key atrule\\\">namespace</span><span class=\\\"token punctuation\\\">:</span> dev\\n  <span class=\\\"token key atrule\\\">labels</span><span class=\\\"token punctuation\\\">:</span>\\n    <span class=\\\"token key atrule\\\">app</span><span class=\\\"token punctuation\\\">:</span> kafka\\n    <span class=\\\"token key atrule\\\">phase</span><span class=\\\"token punctuation\\\">:</span> dev\\n<span class=\\\"token key atrule\\\">spec</span><span class=\\\"token punctuation\\\">:</span>\\n  <span class=\\\"token key atrule\\\">selector</span><span class=\\\"token punctuation\\\">:</span>\\n    <span class=\\\"token key atrule\\\">app</span><span class=\\\"token punctuation\\\">:</span> kafka\\n  <span class=\\\"token key atrule\\\">ports</span><span class=\\\"token punctuation\\\">:</span>\\n  <span class=\\\"token punctuation\\\">-</span> <span class=\\\"token key atrule\\\">port</span><span class=\\\"token punctuation\\\">:</span> <span class=\\\"token number\\\">9092</span>\\n    <span class=\\\"token key atrule\\\">name</span><span class=\\\"token punctuation\\\">:</span> kafka\\n  <span class=\\\"token punctuation\\\">-</span> <span class=\\\"token key atrule\\\">port</span><span class=\\\"token punctuation\\\">:</span> <span class=\\\"token number\\\">8081</span>\\n    <span class=\\\"token key atrule\\\">name</span><span class=\\\"token punctuation\\\">:</span> schema<span class=\\\"token punctuation\\\">-</span>registry\\n  <span class=\\\"token punctuation\\\">-</span> <span class=\\\"token key atrule\\\">port</span><span class=\\\"token punctuation\\\">:</span> <span class=\\\"token number\\\">3030</span>\\n    <span class=\\\"token key atrule\\\">name</span><span class=\\\"token punctuation\\\">:</span> kafka<span class=\\\"token punctuation\\\">-</span>gui\\n  <span class=\\\"token punctuation\\\">-</span> <span class=\\\"token key atrule\\\">port</span><span class=\\\"token punctuation\\\">:</span> <span class=\\\"token number\\\">2181</span>\\n    <span class=\\\"token key atrule\\\">name</span><span class=\\\"token punctuation\\\">:</span> zookeeper\\n  <span class=\\\"token key atrule\\\">clusterIP</span><span class=\\\"token punctuation\\\">:</span> None\\n<span class=\\\"token punctuation\\\">---</span>\\n<span class=\\\"token key atrule\\\">apiVersion</span><span class=\\\"token punctuation\\\">:</span> apps/v1\\n<span class=\\\"token key atrule\\\">kind</span><span class=\\\"token punctuation\\\">:</span> ReplicaSet\\n<span class=\\\"token key atrule\\\">metadata</span><span class=\\\"token punctuation\\\">:</span>\\n  <span class=\\\"token key atrule\\\">namespace</span><span class=\\\"token punctuation\\\">:</span> dev\\n  <span class=\\\"token key atrule\\\">name</span><span class=\\\"token punctuation\\\">:</span> kafka\\n  <span class=\\\"token key atrule\\\">labels</span><span class=\\\"token punctuation\\\">:</span>\\n    <span class=\\\"token key atrule\\\">app</span><span class=\\\"token punctuation\\\">:</span> kafka\\n    <span class=\\\"token key atrule\\\">phase</span><span class=\\\"token punctuation\\\">:</span> dev\\n<span class=\\\"token key atrule\\\">spec</span><span class=\\\"token punctuation\\\">:</span>\\n  <span class=\\\"token key atrule\\\">replicas</span><span class=\\\"token punctuation\\\">:</span> <span class=\\\"token number\\\">1</span>\\n  <span class=\\\"token key atrule\\\">selector</span><span class=\\\"token punctuation\\\">:</span>\\n    <span class=\\\"token key atrule\\\">matchLabels</span><span class=\\\"token punctuation\\\">:</span>\\n      <span class=\\\"token key atrule\\\">app</span><span class=\\\"token punctuation\\\">:</span> kafka\\n  <span class=\\\"token key atrule\\\">template</span><span class=\\\"token punctuation\\\">:</span>\\n    <span class=\\\"token key atrule\\\">metadata</span><span class=\\\"token punctuation\\\">:</span>\\n      <span class=\\\"token key atrule\\\">labels</span><span class=\\\"token punctuation\\\">:</span>\\n        <span class=\\\"token key atrule\\\">app</span><span class=\\\"token punctuation\\\">:</span> kafka\\n    <span class=\\\"token key atrule\\\">spec</span><span class=\\\"token punctuation\\\">:</span>\\n      <span class=\\\"token key atrule\\\">containers</span><span class=\\\"token punctuation\\\">:</span>\\n      <span class=\\\"token punctuation\\\">-</span> <span class=\\\"token key atrule\\\">name</span><span class=\\\"token punctuation\\\">:</span> kafka\\n        <span class=\\\"token key atrule\\\">image</span><span class=\\\"token punctuation\\\">:</span> landoop/fast<span class=\\\"token punctuation\\\">-</span>data<span class=\\\"token punctuation\\\">-</span>dev\\n        <span class=\\\"token key atrule\\\">env</span><span class=\\\"token punctuation\\\">:</span>\\n        <span class=\\\"token punctuation\\\">-</span> <span class=\\\"token key atrule\\\">name</span><span class=\\\"token punctuation\\\">:</span> CONNECT_HEAP\\n          <span class=\\\"token key atrule\\\">value</span><span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">\\\"1G\\\"</span>\\n        <span class=\\\"token punctuation\\\">-</span> <span class=\\\"token key atrule\\\">name</span><span class=\\\"token punctuation\\\">:</span> ADV_HOST\\n          <span class=\\\"token key atrule\\\">value</span><span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">\\\"kafka-service.dev\\\"</span>\\n        <span class=\\\"token key atrule\\\">resources</span><span class=\\\"token punctuation\\\">:</span>\\n          <span class=\\\"token key atrule\\\">limits</span><span class=\\\"token punctuation\\\">:</span>\\n            <span class=\\\"token key atrule\\\">memory</span><span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">\\\"3000Mi\\\"</span>\\n            <span class=\\\"token key atrule\\\">cpu</span><span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">\\\"1\\\"</span>\\n\"\n          }\n        }}></code></pre>\n    </div>\n    <p>{`As you can see to your right (or above for those poor unfortunates trying to read this long thin piece of text on mobile), Kubernetes stuff is defined in YAML (which stands - in the great recursive acronym tradition pioneered by the likes of GNU - for YAML Ain’t Markup).`}</p>\n    <p>{`Note that we’ve created -`}</p>\n    <ol>\n      <li parentName=\"ol\">{`A `}<inlineCode parentName=\"li\">{`kafka-service`}</inlineCode>{` to handle ingress and egress to the Kafka cluster - it is a `}<inlineCode parentName=\"li\">{`ClusterIP`}</inlineCode>{` service, which means no access from outside the cluster, and we’ve gone with an `}<a parentName=\"li\" {...{\n          \"href\": \"https://kubernetes.io/docs/concepts/services-networking/service/#with-selectors\"\n        }}>{`approach`}</a>{` which uses selectors to route traffic to the pod via K8s DNS.`}</li>\n      <li parentName=\"ol\">{`A replica set with a single replica.`}</li>\n    </ol>\n    <p>{`YAML is an irritating language to define things in; it is highly sensitive to spaces, has an awkward way of defining lists or arrays (basically a `}<inlineCode parentName=\"p\">{`-`}</inlineCode>{` followed by a space). Tabs are a no go in YAML and will break everything in hard to detect ways. If that’s unclear and generally unpleasant to wrap your head around… then good, I’m pleased you’re getting a feel for the format.`}</p>\n    <p>{`While YAML looks fine visually, and the intention is quite clear, it is painful to type and prone to errors. If something does go wrong, look for the use of tabs where spaces were intended, or the absence of spaces between `}<inlineCode parentName=\"p\">{`-`}</inlineCode>{`s or `}<inlineCode parentName=\"p\">{`:`}</inlineCode>{`s. The only element that bears commenting on is the `}<inlineCode parentName=\"p\">{`labels`}</inlineCode>{` elements - these are just a way to subset your various K8s entities for subsequent selection and manipulation. You can do things like applying services to pods based on labels, which is what is happening above.`}</p>\n    <p>{`You’ll also `}<strong parentName=\"p\">{`note the almost complete inability to abstract anything away here`}</strong>{` - if you want some common feature (e.g. a set of labels or something) across several services, you’re going to need to either use an additional tool (`}<a parentName=\"p\" {...{\n        \"href\": \"https://github.com/helm/helm\"\n      }}>{`helm`}</a>{` might help), write it out explicitly in each YAML file, or do something with Kubectl to add it to your request (you can do this for `}<a parentName=\"p\" {...{\n        \"href\": \"https://kubernetes.io/docs/concepts/overview/working-with-objects/namespaces/#setting-the-namespace-preference\"\n      }}>{`namespaces`}</a>{`).`}</p>\n    <p>{`Pay attention to which particular K8s API you’re referring to in the `}<inlineCode parentName=\"p\">{`apiVersion`}</inlineCode>{`, as this matters, and dictates which part of the K8s REST API your commands are directed at.`}</p>\n    <p>{`I was originally going to discuss it in the next post, but decided that presenting broken k8s configs as correct is fairly cruel to anyone just trying to find a template for Kafka. Many systems (Kafka in this case) require an environment variable added the Kubernetes manifest along the lines of `}<inlineCode parentName=\"p\">{`ADV_HOST=kafka-service.dev`}</inlineCode>{`. This lets Kafka know which address it is listening on - Confluent explain it better than I can `}<a parentName=\"p\" {...{\n        \"href\": \"https://www.confluent.io/blog/kafka-listeners-explained\"\n      }}>{`here`}</a>{`. If you hit connectivity issues with a system running in Docker containers, checking that the app in the container knows which address to advertise itself at is a good first step in resolving them.`}</p>\n    <h2 {...{\n      \"id\": \"kubernetes-cluster-security\"\n    }}>{`Kubernetes cluster security`}</h2>\n    <p>{`We should first take steps to make sure our new cluster is secure. Sadly the only secure computer is one that is turned off, at the bottom of the ocean. This being incompatible with, well… basically every other requirement we have - we will have to make do with the clusterSecurity.yaml file in the repo, which ensures that;`}</p>\n    <ul>\n      <li parentName=\"ul\">{`No priveleged mode containers run.`}</li>\n      <li parentName=\"ul\">{`No containers can run as root.`}</li>\n      <li parentName=\"ul\">{`Containers can only access NFS volumes and persistent volume claims (for stateful set deployments). In other words, they shouldn’t be touching your local storage.`}</li>\n    </ul>\n    <div className={styles[\"floatright\"]}>\n      <pre><code parentName=\"pre\" {...{\n          \"className\": \"language-yaml\",\n          \"data-language\": \"yaml\",\n          \"data-highlighted-line-numbers\": \"\",\n          \"dangerouslySetInnerHTML\": {\n            \"__html\": \"<span class=\\\"token key atrule\\\">apiVersion</span><span class=\\\"token punctuation\\\">:</span> extensions/v1beta1\\n<span class=\\\"token key atrule\\\">kind</span><span class=\\\"token punctuation\\\">:</span> PodSecurityPolicy\\n<span class=\\\"token key atrule\\\">metadata</span><span class=\\\"token punctuation\\\">:</span>\\n  <span class=\\\"token key atrule\\\">name</span><span class=\\\"token punctuation\\\">:</span> minikubesecurity\\n<span class=\\\"token key atrule\\\">spec</span><span class=\\\"token punctuation\\\">:</span>\\n  <span class=\\\"token key atrule\\\">privileged</span><span class=\\\"token punctuation\\\">:</span> <span class=\\\"token boolean important\\\">false</span>\\n  <span class=\\\"token key atrule\\\">runAsUser</span><span class=\\\"token punctuation\\\">:</span>\\n    <span class=\\\"token key atrule\\\">rule</span><span class=\\\"token punctuation\\\">:</span> MustRunAsNonRoot\\n  <span class=\\\"token key atrule\\\">seLinux</span><span class=\\\"token punctuation\\\">:</span>\\n    <span class=\\\"token key atrule\\\">rule</span><span class=\\\"token punctuation\\\">:</span> RunAsAny\\n  <span class=\\\"token key atrule\\\">fsGroup</span><span class=\\\"token punctuation\\\">:</span>\\n    <span class=\\\"token key atrule\\\">rule</span><span class=\\\"token punctuation\\\">:</span> RunAsAny\\n  <span class=\\\"token key atrule\\\">supplementalGroups</span><span class=\\\"token punctuation\\\">:</span>\\n    <span class=\\\"token key atrule\\\">rule</span><span class=\\\"token punctuation\\\">:</span> RunAsAny\\n  <span class=\\\"token key atrule\\\">volumes</span><span class=\\\"token punctuation\\\">:</span>\\n  <span class=\\\"token punctuation\\\">-</span> <span class=\\\"token string\\\">'nfs'</span>\\n  <span class=\\\"token punctuation\\\">-</span> <span class=\\\"token string\\\">'persistentVolumeClaim'</span>\\n\\n\"\n          }\n        }}></code></pre>\n    </div>\n    <p>{`This is important because one of the major issues people hit when first using Docker in anger is around the use of the root user in the containers. This is bad practice and often a material security risk in Docker (one of the few), so we want to ensure that if we’re doing it inadvertantly in dev, we get an error immediately rather than encountering mysterious issues at deployment (where we hope that the cluster admin has disabled the capability, as we have!)`}</p>\n    <p>{`Apply your security policies using `}<inlineCode parentName=\"p\">{`kubectl create -f clusterSecurity.yaml`}</inlineCode>{`.`}</p>\n    <p>{`The final point to be made on securing this cluster is to take note that `}<strong parentName=\"p\">{`none of the services expose public IP addresses`}</strong>{`. To access (for example) the landoop UIs, we’d run something like `}<inlineCode parentName=\"p\">{`kubectl --namespace=dev port-forward service/kafka-service :3030`}</inlineCode>{`, which forwards the port from our local machine over SSH. This is desirable, because we have not configured security on these GUIs, and by keeping them internal to the cluster we can piggyback off kubectl’s authentication mechanisms and simplify our setup. Clearly, not appropriate for production usage.`}</p>\n    <h2 {...{\n      \"id\": \"kubernetes-services\"\n    }}>{`Kubernetes Services`}</h2>\n    <p>{`We now have a functioning cluster, so let’s get visibility of it using the Kubernetes Dashboard (we’ll do better than this for monitoring, but we’re still bootstrapping and need some visibility while we do so) using `}<inlineCode parentName=\"p\">{`minikube dashboard`}</inlineCode>{`. On a real cluster we’d deploy pods and a service to handle this, but minikube makes things a bit simpler and lets us avoid creation of service accounts and worrying about authentication and so on.`}</p>\n    <p>{`Without any further stuffing about, let’s get it hooked up.`}</p>\n    <ol>\n      <li parentName=\"ol\">{`Create a dev user and namespace with `}<inlineCode parentName=\"li\">{`kubectl apply -f dev-cluster.yaml`}</inlineCode></li>\n      <li parentName=\"ol\">{`Run `}<inlineCode parentName=\"li\">{`kubectl apply -f \\${FILE}`}</inlineCode>{` for each of the components we need (etcd, Fluentd, Kafka) for our dev platform and watch them appear on the dashboard.`}</li>\n    </ol>\n    <p>{`Done. There are many improvements that could be made to this setup, but for writing an application it works as a minimum viable platform. If we were deploying this in the real world, we would have a vastly expanded range of things to think about;`}</p>\n    <ol>\n      <li parentName=\"ol\">{`How does our logging actually work? Fluentd needs somewhere to land its data, and Kafka isn’t a good choice (for reasons that we’ll cover later in the series). We could use Elasticsearch and Kibana (or something similar like Prometheus and Grafana) to visualise our logs from Fluentd.`}</li>\n      <li parentName=\"ol\">{`Authentication for all these front ends we’re creating, and then Authorization to determine what permissions people should have.`}</li>\n      <li parentName=\"ol\">{`Where are we going for level two support? If we can’t fix something ourselves who do we bring in and how much money do we have to pay them?`}</li>\n      <li parentName=\"ol\">{`What network connectivity do we need? Load balancing? CDNs?`}</li>\n      <li parentName=\"ol\">{`While we’re talking about load, what about autoscaling?`}</li>\n    </ol>\n    <p>{`6 - 100. Everything else.`}</p>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;\nexport const tableOfContents = (components={}) => [\n  {\n    id: \"but-my-code-is-already-unit-tested\",\n    level: 3,\n    title: \"“But my code is already unit tested!”\",\n    children: [\n        \n      ]\n  },\n{\n    id: \"whats-in-the-box-about-the-images-were-using\",\n    level: 3,\n    title: \"What’s in the box? About the images we’re using.\",\n    children: [\n        \n      ]\n  },\n{\n    id: \"pre-requisites\",\n    level: 2,\n    title: \"Pre-requisites\",\n    children: [\n        \n      ]\n  },\n{\n    id: \"getting-started---minikube\",\n    level: 2,\n    title: \"Getting started - Minikube\",\n    children: [\n        \n      ]\n  },\n{\n    id: \"kubernetes-concepts-and-setup\",\n    level: 2,\n    title: \"Kubernetes Concepts and setup\",\n    children: [\n        \n      ]\n  },\n{\n    id: \"running-an-application-on-kubernetes\",\n    level: 2,\n    title: \"Running an application on Kubernetes\",\n    children: [\n        {\n              id: \"kubernetes-pods\",\n              level: 3,\n              title: \"Kubernetes pods\",\n              children: [\n                      \n                    ]\n            },\n      {\n              id: \"controllers-services-and-everything-else\",\n              level: 3,\n              title: \"Controllers, services… and everything else\",\n              children: [\n                      \n                    ]\n            },\n      {\n              id: \"defining-kubernetes-entities\",\n              level: 3,\n              title: \"Defining Kubernetes entities\",\n              children: [\n                      \n                    ]\n            }\n      ]\n  },\n{\n    id: \"kubernetes-cluster-security\",\n    level: 2,\n    title: \"Kubernetes cluster security\",\n    children: [\n        \n      ]\n  },\n{\n    id: \"kubernetes-services\",\n    level: 2,\n    title: \"Kubernetes Services\",\n    children: [\n        \n      ]\n  }\n]\n\nexport const frontMatter = {}\n\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"image\":\"document_image__P0Wy7\",\"figure\":\"document_figure__gp_zq\",\"figureright\":\"document_figureright__JTrdm\",\"figureleft\":\"document_figureleft__yBEAN\",\"sidebarcontainer\":\"document_sidebarcontainer__PXI6m\",\"sidebar\":\"document_sidebar__uvsTe\"};","module.exports = __webpack_public_path__ + \"static/media/hacker.d472712f.gif\";","module.exports = __webpack_public_path__ + \"static/media/another_hacker.1c323ee1.gif\";"],"sourceRoot":""}